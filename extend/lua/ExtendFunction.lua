-- Author: 华盛顿的棒子
-- DateCreated: 2021/2/22 21:38:22
--------------------------------------------------------------
include("Rog_SaveUtils.lua"); MY_MOD_NAME = "世界强权";
include("PlotIterators.lua");
include("FLuaVector.lua");
include("CityView.lua")
include("InfoTooltipInclude");
include("FunctionUtilities.lua");


function CanHavePromotion(iPlayer, iUnit, iPromotionType)
  local pUnit = Players[iPlayer]:GetUnitByID(iUnit)


  if iPromotionType == GameInfoTypes.PROMOTION_GUN_2 then
  if pUnit:GetBaseRangedCombatStrength()>0   then 
  return false
     end
  end

  if iPromotionType == GameInfoTypes.PROMOTION_AIR_RANGE_EXTEND then
  if pUnit:GetUnitType() == GameInfoTypes["UNIT_NUCLEAR_ARTILLERY"]  then 
  return false
     end
  end

  if iPromotionType == GameInfoTypes.PROMOTION_DRILL_4 or iPromotionType == GameInfoTypes.PROMOTION_SHOCK_4 then
  if pUnit:GetUnitClassType() ~=GameInfo.UnitClasses.UNITCLASS_GLADIATOR.ID then
  return false
     end
  end

   return true
end
GameEvents.CanHavePromotion.Add(CanHavePromotion)


function TourismToGold(iPlayer, iUnit, iX, iY, bIsGreatPerson)
local pPlayer = Players[iPlayer]
local pUnit = pPlayer:GetUnitByID(iUnit)
if bIsGreatPerson 
and pPlayer:HasWonder(GameInfoTypes.BUILDING_KARLSTEJN) then
local gold = pPlayer:CalculateGoldRate()
pPlayer:ChangeGold(3*gold)
   end
end
GameEvents.TourismDiscover.Add(TourismToGold)



function ProduceCopy(iPlayer, iUnit, iGreatWork)
	local player = Players[iPlayer]
	if player == nil or (not player:IsMajorCiv())   then
		return
	end 
	if player:GetNumCities() <= 0 or not player:HasWonder(GameInfoTypes.BUILDING_KARLSTEJN)   then
		return
	end

		local gw
		for i,v in ipairs(player:GetGreatWorks(4)) do
			if load(player,"HaveCopied" .. Game.GetGreatWorkName(v.Index)) == nil and Game.GetGreatWorkCreator(v.Index) == iPlayer then
				gw = v.Index
				save(player,"HaveCopied" .. Game.GetGreatWorkName(v.Index), true)
				break
			end
		end
		if gw then
			local city = player:GetCityOfClosestGreatWorkSlot(player:GetCapitalCity():GetX(), player:GetCapitalCity():GetY(), GameInfoTypes["GREAT_WORK_SLOT_MUSIC"])
			if city then
		        local building = player:GetBuildingOfClosestGreatWorkSlot(player:GetCapitalCity():GetX(), player:GetCapitalCity():GetY(), GameInfoTypes["GREAT_WORK_SLOT_MUSIC"])
		        if  building then
			        building = GameInfo.Buildings[building]
			        local buildingClass = building.BuildingClass
			        local availableSlots = building.GreatWorkCount
					for slot = 0, availableSlots-1, 1 do
						if  city:GetBuildingGreatWork(GameInfoTypes[buildingClass], slot) == -1 then
							city:SetBuildingGreatWork(GameInfoTypes[buildingClass],slot,gw)
							break
						--end
					end
				end
			end
		end
	end
end
GameEvents.GreatWorkCreated.Add(ProduceCopy)




function RemoveJungle(iPlayer, iUnit, iX, iY, iBuild)
   if iBuild == GameInfoTypes.BUILD_REMOVE_JUNGLE 
   or iBuild == GameInfoTypes.BUILD_REMOVE_FOREST then
   local  pPlot = Map.GetPlot(iX, iY)
   if  pPlot:GetResourceType()==GameInfoTypes.RESOURCE_LUMBER then
   pPlot:SetResourceType(-1)
       end
    end
 end
GameEvents.PlayerBuilt.Add(RemoveJungle)


-- ********************************************************
-- 阿基米德
-- ********************************************************	 
function ARCHIMEDES(plot)
         if plot==nil then
         return false
		 end
		 local city= plot:GetWorkingCity()
		 if city~=nil and city:IsHasBuilding(GameInfoTypes.BUILDING_ARCHIMEDES) then
		    return true  
	    end
  return false 
end 

function ARCHIMEDES(iPlayer, iUnit, iX, iY, iBuild)
   if iBuild == GameInfoTypes.BUILD_BEACON  then
   local plot= Map.GetPlot(iX, iY)
   local pPlayer = Players[iPlayer]
   if pPlayer:HasWonder(GameInfoTypes.BUILDING_ARCHIMEDES) 
   and ARCHIMEDES(plot) 
   and pPlayer:CountAllImprovement(GameInfoTypes["IMPROVEMENT_BEACON"])==0    then
      return true
		 end   
	  return false
	  end
	  return true
 end
GameEvents.PlayerCanBuild.Add(ARCHIMEDES)


-- **********************************************************************************************************************************************
-- 购买地块
-- **********************************************************************************************************************************************
function GetCultureGain(pPlayer)
	local iEra = pPlayer:GetCurrentEra()
	return (iEra + 1) 
end


function MagaBoughtPlot(iPlayer, iCity, iPlotX, iPlotY, bGold, bCulture)  
	local Player = Players[iPlayer]
	--local plot = Map.GetPlot(iPlotX, iPlotY)
	local city = Player:GetCityByID(iCity)
	if Player:HasTrait(GameInfoTypes["TRAIT_RIVER_EXPANSION"]) then
	--if bGold then
	local iGain = GetCultureGain(Player)
	--city:ChangeProduction(20*iGain)
	city:ChangeOverflowProduction(10*iGain)
	--Player:ChangeJONSCulture(20*iGain)
	  -- end
	end
end
GameEvents.CityBoughtPlot.Add(MagaBoughtPlot)



-- ********************************************************
-- 环球航行
-- ********************************************************
local g_NotificationType = NotificationTypes.NOTIFICATION_GENERIC
function OnMagellanNotificationId(id)
  print(string.format("Setting magellan notification id to %i", id))
  g_NotificationType = id
end
LuaEvents.MagellanNotificationId.Add(OnMagellanNotificationId)

function OnCircumnavigatedGlobe(iTeam)
  local pPlayer = Players[Game.GetActivePlayer()]
  local sHead = Locale.ConvertTextKey("TXT_KEY_MAGELLAN_HEAD")
  local sText = Locale.ConvertTextKey("TXT_KEY_MAGELLAN_TEXT_UNKNOWN")

  local Team = Teams[iTeam]
  local Player = Players[Team:GetLeaderID()];
  local plot =  Player:GetCapitalCity():Plot()
  local Unit  = Player:InitUnit(GameInfoTypes.UNIT_SCIENTIST, plot:GetX(), plot:GetY())

  if (Game.GetActiveTeam() == iTeam) then
    sText = Locale.ConvertTextKey("TXT_KEY_MAGELLAN_TEXT_YOU")
  else
    if (Teams[Game.GetActiveTeam()]:IsHasMet(iTeam)) then
      sText = Locale.ConvertTextKey("TXT_KEY_MAGELLAN_TEXT_KNOWN", Players[Teams[iTeam]:GetLeaderID()]:GetCivilizationShortDescriptionKey())
	end
  end

  pPlayer:AddNotification(g_NotificationType, sText, sHead, -1, -1, -1, -1)
end
GameEvents.CircumnavigatedGlobe.Add(OnCircumnavigatedGlobe)
LuaEvents.MagellanNotificationIdRequest()


-- ********************************************************
-- 
-- ********************************************************           
function GUIGU_SPY(iPlayer, iSpy, iResult, iCityX, iCityY) 
   local Player = Players[iPlayer]
   local tSpecialists ={}

   if Player == nil or (not Player:IsMajorCiv())
   or (not Player:HasWonder(GameInfoTypes.BUILDING_GUIGU)) then
      return
   end

   local iTeamID = Player:GetTeam()
   local iTeam = Teams[iTeamID]
   local iTeamTechs = iTeam:GetTeamTechs()
   local iGoldPerTurn = Player:CalculateGoldRate()
   local Science=math.max(0,4*Player:GetScience())
   if  iResult then

   --City:ChangeDamage(50)

   Player:ChangeGold(2*iGoldPerTurn)
   ChangeResearchProcess(Player, iTeamID, iTeam, iTeamTechs, iPlayer, science)

  local randomNumber = ROG_GetTrueRandom(1, 100)
  if randomNumber>=80 then
  local iX, iY = GetGuiGuCity(Player):GetX(), GetGuiGuCity(Player):GetY() 
 
  for row in GameInfo.Units() do
  if  row.Special=='SPECIALUNIT_PEOPLE' then
	    table.insert(tSpecialists, row.ID)
		   end
		end
		   if #tSpecialists > 0 then
			  local randomNumber = ROG_GetTrueRandom(1, #tSpecialists)
			  local tSpecialist = tSpecialists[randomNumber]
			  Specialistinfo = GameInfo.Units{ID=tSpecialist}()    
              local SpecialistUnit = Player:InitUnit(Specialistinfo.ID, iX,iY)
			  SpecialistUnit:JumpToNearestValidPlot()
             end	
         end

     end

end 	
GameEvents.EspionageResult.Add(GUIGU_SPY)  
   

-- ****************************************
--
-- ****************************************	
function SoldBuildingBuff(iPlayer, iCity, iBuilding)
	local player = Players[iPlayer]
	local city = player:GetCityByID(iCity)

	if player == nil or (not player:IsMajorCiv())   then
		return
	end

	if  player:HasWonder(GameInfoTypes.BUILDING_ROCKEFELLER)  then
	for row in GameInfo.Buildings("HurryCostModifier <> -1") do
	if  row.ID == iBuilding then 
	city:ChangeProduction(row.Cost)	
	for Othercity in player:Cities() do  
	if  Othercity~=city then
	Othercity:ChangeProduction(0.25*row.Cost)	
	                 end
		          end	
		      end
		  end
	 end 
end 	
GameEvents.CitySoldBuilding.Add(SoldBuildingBuff)  





local iFreezeCollectionID = GameInfoTypes["PROMOTION_COLLECTION_FREEZE_BOMB"];
local iFreezedCollectionID = GameInfoTypes["PROMOTION_COLLECTION_FREEZE_EFFECT"];
GameEvents.OnTriggerAddEnemyPromotion.Add(function(eThisPromotionType, eThisPromotionCollection, eThisBattleType, iThisPlayer,
 iThisUnit, iThisUnitType, eThatPromotionType,eThatPromotionCollection, iThatPlayer, iThatUnit, iThatUnitType)

    if eThisPromotionCollection ~= iFreezeCollectionID or eThatPromotionCollection ~= iFreezedCollectionID then
        return;
    end

    local pThisPlayer = Players[iThisPlayer];
    local pThatPlayer = Players[iThatPlayer];
    if pThisPlayer == nil or pThatPlayer == nil then
        return;
    end

    local pThisUnit = pThisPlayer:GetUnitByID(iThisUnit);
    local pThatUnit = pThatPlayer:GetUnitByID(iThatUnit);
    if pThisUnit == nil or pThatUnit == nil then
        return;
    end

    if eThatPromotionType == -1 then
        return;
    end

    local thisUnitName = pThisUnit:GetName();
    local thatUnitName = pThatUnit:GetName();
    if pThisPlayer:IsHuman() then
        local text = Locale.ConvertTextKey("TXT_KEY_SP_NOTIFICATION_ENEMY_FREEZE", thisUnitName, thatUnitName);
        Events.GameplayAlertMessage(text);
    end
    if pThatPlayer:IsHuman() then
        local text = Locale.ConvertTextKey("TXT_KEY_SP_NOTIFICATION_US_FREEZE", thisUnitName, thatUnitName);
        Events.GameplayAlertMessage(text);
    end
end);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      